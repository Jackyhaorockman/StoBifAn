function para_match = parameter_continuation(ind, check_fcn, check_para)
% PARAMETER_CONTINUATION 


n_par = length(ind); % number of parameters

n_point = 3^n_par;   % total number of surrounding parameter points (including itself)

% a matrix storing the shift vector that loop through all surrounding
% grid points
pos = zeros(n_point, n_par);

rec = [-1, 0, 1];

for i = 1 : n_par
    
    s_rec = i-1;
    
    l_rec = n_par - i;
    
    vec_shift = kron(ones(1,3^s_rec), kron(rec, ones(1,3^l_rec)))';
    
    pos(:,i) = vec_shift;
    
end


check_stop = 0;
para_match = ind;
para_center = ind;
para_index = 1;
check_close = 0;

% continuation states
while check_stop == 0
    
    for i = 1 : n_point % loop through all the surrounding points
        
        if i ~= (n_point + 1)/2 % do not check the center points
            
            % the current grid points
            para_current = para_center + pos(i,:);
            
            % check if the grid point satisfy certain criteria
            check_value = check_fcn(par, check_para);
            
            if check_value == 1 % satisfied
                
                % add current grid index
                para_match = [para_match; para_current];
                
                % set current grid points to 0, (this means the grid point
                % will be used as a center point to search its surrounding
                % points.
                check_close = [check_close; 0];
                
            end
        end
        
        % close the center point
        check_close(para_index) = 1;
        
        % check if there are some repeated points; if yes, delete them.
        [para_match, ia, ~] = unique(para_match,'rows');
        
        check_close = check_close(ia);
        
        % locate the next searching points:
        para_index = find(check_close == 0, 1);
        
        % check if the searching is complete
        if isempty(para_index)
            
            check_stop = 1; % stop the iteration
            
        else
            
            para_center = para_match(para_index,:); % reset the center point
            
        end
        
    end
    
end


end